% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/shared_bootstrap.R
\name{bootstrap_variance.survey.design}
\alias{bootstrap_variance.survey.design}
\title{Bootstrap for survey designs via replicate weights}
\usage{
bootstrap_variance.survey.design(
  data,
  estimator_func,
  point_estimate,
  bootstrap_reps = 500,
  survey_na_policy = c("strict", "omit"),
  ...
)
}
\arguments{
\item{data}{a `data.frame` or a `survey.design`.}

\item{estimator_func}{function that returns an S3 result object; the primary
estimate is extracted via `$y_hat` and convergence via `$converged`.}

\item{point_estimate}{numeric; point estimate used for some survey variance formulas.}

\item{bootstrap_reps}{integer; number of bootstrap replicates.}

\item{survey_na_policy}{Character string specifying how to handle replicates
that fail to produce estimates. Options:
\describe{
  \item{\code{"strict"}}{(default) Any failed replicate causes an error.
    This ensures the full replicate design structure is maintained and
    is required for proper calibration-based variance.}
  \item{\code{"omit"}}{Failed replicates are omitted. The corresponding
    \code{rscales} are also omitted to maintain correct variance scaling.
    Use with caution: if failures are non-random, variance may be biased.}
}}

\item{...}{passed through to `estimator_func`.}
}
\value{
a list with `se`, `variance`, and the vector of `replicates`.
}
\description{
Bootstrap for survey designs via replicate weights
}
\details{
This path constructs a replicate-weight design using
  [svrep::as_bootstrap_design()] and rebuilds the original sampling design for
  each replicate weight vector. The supplied design must have been created
  directly with [survey::svydesign()].

  \strong{NA policy:} By default, survey bootstrap uses a strict NA policy:
  if any replicate fails to produce a finite estimate, the entire bootstrap
  fails with an error. This ensures that the full replicate design structure
  is maintained for design-calibrated variance via \code{survey::svrVar()}.
  In contrast, IID bootstrap allows up to 10\% failures before warning and
  uses \code{stats::var()} on the successful replicates.
}
\section{Limitations}{

  \strong{Design reconstruction:} Survey bootstrap currently supports only
  designs created directly with \code{survey::svydesign()}. Post-hoc
  adjustments applied via \code{survey::calibrate()},
  \code{survey::postStratify()}, or \code{survey::rake()} cannot be
  reconstructed across bootstrap replicates and will cause the function to
  error.

  Calibrated or post-stratified designs are not supported by this bootstrap
  path. Start from the original `survey::svydesign()` object prior to
  calibration/post-stratification.

  \strong{Supported design features:} The following \code{svydesign()}
  parameters are preserved during reconstruction:
  \itemize{
    \item \code{ids} (or \code{id}): Sampling unit identifiers
    \item \code{strata}: Stratification variables
    \item \code{fpc}: Finite population correction
    \item \code{nest}: Nested vs non-nested strata
  }

  The following are not preserved (they conflict with replicate weights):
  \itemize{
    \item \code{probs}: Sampling probabilities (incompatible with direct weights)
    \item \code{pps}: PPS sampling specification (incompatible with direct weights)
  }

  \strong{Rationale:} When reconstructing designs for each replicate, the
  original analysis weights are replaced with bootstrap replicate weights.
  Specifying both \code{weights} and \code{probs}/\code{pps} simultaneously
  is undefined behavior in \code{survey::svydesign()}. The structural
  design parameters (ids, strata, fpc, nest) define the sampling topology
  and are preserved; the weights define the analysis weights and are
  replaced.
}

\keyword{internal}
