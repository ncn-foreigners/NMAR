name: Validate Generated Sources

on:
  push:
    branches: ["**"]
  pull_request:

jobs:
  regen-check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: r-lib/actions/setup-r@v2

      - name: Install remotes
        run: R -q -e "install.packages('remotes', quiet = TRUE)"

      - name: Install devtools
        run: R -q -e "remotes::install_cran('devtools', quiet = TRUE)"

      - name: Rebuild generated code
        run: Rscript build_r_folder.R

      - name: Regenerate documentation
        run: R -q -e "devtools::document(quiet = TRUE)"

      - name: Ensure generated artifacts are clean
        run: git diff --exit-code
