# NMAR

The goal of **NMAR** is to provide a set of functions to **estimate the
population mean** of data subject to Not Missing At Random (NMAR)
mechanisms using advanced statistical methods

## Overview

The **NMAR** library provides functions to estimate the mean of **Not
Missing At Random (NMAR)** data. The estimation functions are built upon
the following engine functions, each implementing a distinct method:

- `exptilt_engine`: Exponential Tilting Estimator  
  Minsun Kim Riddles, Jae Kwang Kim, Jongho Im  
  A Propensity-score-adjustment Method for Nonignorable Nonresponse  
  <https://doi.org/10.1093/jssam/smv047>

- `exptilt_nonparam_engine`: Nonparametric Exponential Tilting
  Estimator  
  Minsun Kim Riddles, Jae Kwang Kim, Jongho Im  
  A Propensity-score-adjustment Method for Nonignorable Nonresponse  
  Appendix 2  
  <https://doi.org/10.1093/jssam/smv047>

- `el_engine`: Empirical Likelihood Estimator  
  Jing Qin, Denis Leung, Jun Shao  
  Estimation With Survey Data Under Nonignorable Nonresponse or
  Informative Sampling  
  <http://dx.doi.org/10.1198/016214502753479338>

The main user-facing function is
[`nmar()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/nmar.md),
which acts as a unified wrapper around these engine functions.

## Installation

You can install the development version of NMAR from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("ncn-foreigners/NMAR")
```

or

``` R
remotes::install_github("ncn-foreigners/NMAR@main", force = T, build = T, build_manual = T, build_vignettes = T)
```

### Project branches:

- `main` - The stable production branch. This is the version you should
  install for general use
- `package-pre_prod` - The pre-production development branch. This is a
  stable, installable version reflecting the latest features. (1:1 clone
  of `package-dev`)
- `package-dev` - The **internal development branch**. This branch uses
  a non-R package structure for internal development purposes. **DO
  NOT** download or install this branch. For contribution guidelines,
  please see the CONTRIBUTING.md file or the \[project webpage (TODO:
  add link to webpage)\]

## Usage

### General naming

- `outcome_var` (f.e Y): The outcome variable (with missing values).
- `covariates_for_outcome`(f.e x1,x2): Predictors of `outcome_var` value
  (used in the response model).
- `covariates_for_missingness`(f.e x3): Predictor of `outcome_var`
  missingness (used in the missingness model).

`formula` = outcome_var ~ covariates_for_outcome

### Example

If, in a salary survey, richer people were less likely to answer, `Y` is
salary, `x1` and `x2` are experience and education, and `x3` might be
gender (if we assume gender affects the likelihood of responding but not
the salary value itself).

``` r
library(NMAR, quietly = T)

exptilt_config <- exptilt_engine(
  y_dens = 'normal',
  family = 'probit', # or logit
  variance_method = 'bootstrap', # or delta
  bootstrap_reps = 10
)

formula = y ~ x
res <- nmar(formula = formula, data = riddles_case1, engine = exptilt_config, trace_level = 0)
print(coef(res))
#> (Intercept)           y 
#>   0.5330497  -0.1026425
print(res)
#> NMAR Result
#> ------------
#> y mean: -1.002967 (0.055358)
#> Converged: TRUE 
#> Variance method: bootstrap 
#> Estimator: exponential_tilting
```

## Getting help

If you encounter a clear bug, please file an issue with a minimal
reproducible example on
[GitHub](https://github.com/ncn-foreigners/NMAR/issues)

## Authors and acknowledgments

Research grant: [OPUS 20
\#2020/39/B/HS4/00941](https://ncn-foreigners.ue.poznan.pl/)

- [Maciej Beręsewicz](https://github.com/berenz)
- [Igor Kołodziej](https://github.com/IgorKolodziej)
- [Mateusz Iwaniuk](https://github.com/Iwaniukooo11)

# Package index

## Engines

- [`el_engine()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/el_engine.md)
  : Empirical likelihood (EL) engine for NMAR
- [`exptilt_engine()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/exptilt_engine.md)
  : Exponential tilting (ET) engine for NMAR estimation
- [`exptilt_nonparam_engine()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/exptilt_nonparam_engine.md)
  : Nonparametric exponential tilting (EM) engine for NMAR

## NMAR

- [`nmar()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/nmar.md)
  : Not Missing at Random (NMAR) Estimation

## Result analysis

- [`coef(`*`<summary_nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/coef.summary_nmar_result.md)
  : Coefficient table for summary objects
- [`confint(`*`<summary_nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/confint.summary_nmar_result.md)
  : Confidence intervals for coefficient table (summary objects)
- [`glance(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/glance.nmar_result.md)
  : Glance summary for NMAR results
- [`print(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/print.nmar_result.md)
  : Print method for nmar_result
- [`print(`*`<nmar_result_el>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/print.nmar_result_el.md)
  : Print method for EL results
- [`print(`*`<summary_nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/print.summary_nmar_result.md)
  : Print method for summary.nmar_result
- [`summary(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/summary.nmar_result.md)
  : Summary method for nmar_result
- [`summary(`*`<nmar_result_el>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/summary.nmar_result_el.md)
  : Summary method for EL results
- [`tidy(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/tidy.nmar_result.md)
  : Tidy summary for NMAR results

## Engine analysis

- [`engine_config()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/engine_config.md)
  : Extract engine configuration
- [`engine_name()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/engine_name.md)
  : Canonical engine name
- [`format(`*`<nmar_engine>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/format.nmar_engine.md)
  : One-line formatter for NMAR engines
- [`nmar_engine_helpers`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/nmar_engine_helpers.md)
  : S3 helpers for NMAR engine objects
- [`print(`*`<nmar_engine>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/print.nmar_engine.md)
  : Print method for NMAR engines

## Result params

- [`coef(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/coef.nmar_result.md)
  : Default coefficients for NMAR results
- [`confint(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/confint.nmar_result.md)
  : Wald confidence interval for base NMAR results
- [`fitted(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/fitted.nmar_result.md)
  : Default fitted values for NMAR results
- [`formula(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/formula.nmar_result.md)
  : Default formula for NMAR results
- [`se()`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/se.md)
  : Extract standard error for NMAR results
- [`vcov(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/vcov.nmar_result.md)
  : Variance-covariance for base NMAR results
- [`weights(`*`<nmar_result>`*`)`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/weights.nmar_result.md)
  : Extract Weights from NMAR Result

## Datasets

- [`polish_households`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/polish_households.md)
  : Polish Household Budget Data with Simulated Nonignorable Nonresponse
- [`riddles_case1`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/riddles_case1.md)
  : Riddles Simulation, Case 1: Linear Mean
- [`riddles_case2`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/riddles_case2.md)
  : Riddles Simulation, Case 2: Exponential Mean
- [`riddles_case3`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/riddles_case3.md)
  : Riddles Simulation, Case 3: Sine Wave Mean
- [`riddles_case4`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/riddles_case4.md)
  : Riddles Simulation, Case 4: Cubic Mean
- [`voting`](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/reference/voting.md)
  : Aggregated Exit Poll Data for Gangdong-Gap (2012)

# Articles

### Estimators

Step-by-step tutorials for using estimators in nmar package including
both data.frame and survey design objects

- [Empirical
  Likelihood](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/articles/tutorial_empirical_likelihood.md):

  Jing Qin, Denis Leung, Jun Shao  
  Estimation With Survey Data Under Nonignorable Nonresponse or
  Informative Sampling  
  <http://dx.doi.org/10.1198/016214502753479338>

- [Exponential
  Tilting](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/articles/tutorial_exptilt.md):

  Minsun Kim Riddles, Jae Kwang Kim, Jongho Im  
  A Propensity-score-adjustment Method for Nonignorable Nonresponse  
  <https://doi.org/10.1093/jssam/smv047>

- [Exponential Tilting
  (Nonparametric)](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/articles/tutorial_exptilt_nonparam.md):

  Minsun Kim Riddles, Jae Kwang Kim, Jongho Im  
  A Propensity-score-adjustment Method for Nonignorable Nonresponse  
  Appendix 2  
  <https://doi.org/10.1093/jssam/smv047>

### Developer

- [Developing a New NMAR
  Estimator](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/articles/developing_new_nmar_estimator.md):

  Guide for adding a new NMAR estimator to the `nmar` package

### Theory

- [Empirical Likelihood
  Theory](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/articles/el_empirical_likelihood_theory.md):
- [Exponential Tilting
  Theory](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/articles/exptilt_theory.md):
- [Nonparametric Exponential Tilting
  Theory](https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/articles/exptilt_nonparam_theory.md):
