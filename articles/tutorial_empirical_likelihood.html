<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Empirical Likelihood • NMAR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Likelihood">
<meta name="description" content="Jing Qin, Denis Leung, Jun Shao &lt;br&gt;
Estimation With Survey Data Under Nonignorable Nonresponse or Informative Sampling &lt;br&gt;
https://doi.org/10.1198/016214502753479338
">
<meta property="og:description" content="Jing Qin, Denis Leung, Jun Shao &lt;br&gt;
Estimation With Survey Data Under Nonignorable Nonresponse or Informative Sampling &lt;br&gt;
https://doi.org/10.1198/016214502753479338
">
<meta property="og:image" content="https://ncn-foreigners.ue.poznan.pl/NMAR/index.html/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NMAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/tutorial_empirical_likelihood.html">Empirical Likelihood</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial_exptilt.html">Exponential Tilting</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial_exptilt_nonparam.html">Exponential Tilting (Nonparametric)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Theory</h6></li>
    <li><a class="dropdown-item" href="../articles/el_empirical_likelihood_theory.html">Empirical Likelihood Theory</a></li>
    <li><a class="dropdown-item" href="../articles/exptilt_theory.html">Exponential Tilting Theory</a></li>
    <li><a class="dropdown-item" href="../articles/exptilt_nonparam_theory.html">Nonparametric Exponential Tilting Theory</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncn-foreigners/NMAR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Empirical Likelihood</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncn-foreigners/NMAR/blob/package-dev/vignettes/tutorial_empirical_likelihood.Rmd" class="external-link"><code>vignettes/tutorial_empirical_likelihood.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial_empirical_likelihood.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates the empirical likelihood (EL) estimator
for Not Missing At Random (NMAR) data in the NMAR package. The primary
estimand is the full-data mean of the outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
under the QLS NMAR model. The method implements the estimator of Qin,
Leung, and Shao (2002), using empirical likelihood weights that satisfy
estimating equations for the response mechanism and (optionally)
auxiliary moment constraints. For full derivations, the analytic
Jacobian, and variance discussion (bootstrap), see the companion article
“Empirical Likelihood Theory for NMAR”.</p>
<p>Key features:</p>
<ul>
<li>Supports <code>data.frame</code> (IID) and
<code>survey.design</code> objects via the same <code><a href="../reference/nmar.html">nmar()</a></code>
API.</li>
<li>Variance via bootstrap (IID resampling or survey replicate
weights).</li>
<li>Optional standardization of predictors; weight trimming for
robustness.</li>
<li>Rich S3 surface: <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code>,
<code>tidy()</code>, <code>glance()</code>, <code><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights()</a></code>,
<code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>.</li>
</ul>
<div class="section level3">
<h3 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h3>
<ul>
<li>Specify the model with a two-sided formula:
<code>Y_miss ~ X1 + X2 | Z1 + Z2</code> where auxiliaries are left of
<code>|</code> and response-only predictors are right of <code>|</code>.
If <code>|</code> is omitted, RHS variables are treated only as
auxiliaries; the response model uses the outcome (LHS) and any
predictors explicitly placed to the right of <code>|</code>.
<ul>
<li>Variables on the outcome RHS (e.g., <code>X1 + X2</code>) are
auxiliaries; supply their known population means via
<code>auxiliary_means = c(X1 = ..., X2 = ...)</code>.</li>
<li>Predictors to the right of <code>|</code> enter only the response
model (no auxiliary constraint) and do not need population means.</li>
<li>If you want a covariate to enter both the auxiliary constraints and
the response model (as in the original QLS setup), include it on both
sides, for example: <code>Y_miss ~ X | X</code>.</li>
</ul>
</li>
<li>Choose the engine: <code>el_engine(...)</code>, e.g.,
<code>el_engine(auxiliary_means = c(X1 = 0), variance_method = "bootstrap", standardize = TRUE)</code>.</li>
<li>Fit:
<code>nmar(formula = Y_miss ~ X1 + X2 | Z1 + Z2, data = df_or_design, engine = el_engine(...))</code>.</li>
<li>Inspect: <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code>,
<code><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights()</a></code>, <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>, and
<code>fit$diagnostics</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="data-frame-example-iid">Data-frame example (IID)<a class="anchor" aria-label="anchor" href="#data-frame-example-iid"></a>
</h2>
<p>We simulate an NMAR mechanism where the response probability depends
on the unobserved outcome.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncn-foreigners/NMAR" class="external-link">NMAR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Z</span></span>
<span></span>
<span><span class="co"># NMAR response: depends on Y</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">p</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y_miss <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">Y_miss</span><span class="op">[</span><span class="op">!</span><span class="va">R</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/el_engine.html">el_engine</a></span><span class="op">(</span>auxiliary_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, variance_method <span class="op">=</span> <span class="st">"none"</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Fit EL estimator (no variance for speed in vignette)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmar.html">nmar</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y_miss</span> <span class="op">~</span> <span class="va">X</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">engine</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; NMAR Model Summary</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; Y_miss mean: 1.878660</span></span>
<span><span class="co">#&gt; Converged: TRUE </span></span>
<span><span class="co">#&gt; Variance method: none </span></span>
<span><span class="co">#&gt; Variance notes: Variance skipped (variance_method='none') </span></span>
<span><span class="co">#&gt; Total units: 500 </span></span>
<span><span class="co">#&gt; Respondents: 150 </span></span>
<span><span class="co">#&gt; Call: nmar(Y_miss ~ X, data = &lt;data.frame: N=500&gt;, engine = empirical_likelihood)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Missingness-model coefficients:</span></span>
<span><span class="co">#&gt;              Estimate</span></span>
<span><span class="co">#&gt; (Intercept) -1.570694</span></span>
<span><span class="co">#&gt; Y_miss       0.366754</span></span>
<span><span class="co"># For confidence intervals, use bootstrap variance (see example below).</span></span></code></pre></div>
<p>Probit family (optional):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/el_engine.html">el_engine</a></span><span class="op">(</span>auxiliary_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"probit"</span>, variance_method <span class="op">=</span> <span class="st">"none"</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_probit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmar.html">nmar</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y_miss</span> <span class="op">~</span> <span class="va">X</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">engine</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_probit</span><span class="op">)</span></span>
<span><span class="co">#&gt; NMAR Model Summary</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; Y_miss mean: 1.880128</span></span>
<span><span class="co">#&gt; Converged: TRUE </span></span>
<span><span class="co">#&gt; Variance method: none </span></span>
<span><span class="co">#&gt; Variance notes: Variance skipped (variance_method='none') </span></span>
<span><span class="co">#&gt; Total units: 500 </span></span>
<span><span class="co">#&gt; Respondents: 150 </span></span>
<span><span class="co">#&gt; Call: nmar(Y_miss ~ X, data = &lt;data.frame: N=500&gt;, engine = empirical_likelihood)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Missingness-model coefficients:</span></span>
<span><span class="co">#&gt;              Estimate</span></span>
<span><span class="co">#&gt; (Intercept) -0.949678</span></span>
<span><span class="co">#&gt; Y_miss       0.217504</span></span></code></pre></div>
<p>Tidy/glance summaries (via the <code>generics</code> package):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">generics</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;          term   estimate std.error conf.low conf.high component statistic</span></span>
<span><span class="co">#&gt; 1      Y_miss  1.8786601        NA       NA        NA  estimand        NA</span></span>
<span><span class="co">#&gt; 2 (Intercept) -1.5706942        NA       NA        NA  response        NA</span></span>
<span><span class="co">#&gt; 3      Y_miss  0.3667545        NA       NA        NA  response        NA</span></span>
<span><span class="co">#&gt;   p.value</span></span>
<span><span class="co">#&gt; 1      NA</span></span>
<span><span class="co">#&gt; 2      NA</span></span>
<span><span class="co">#&gt; 3      NA</span></span>
<span><span class="fu">generics</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;     y_hat std.error conf.low conf.high converged trimmed_fraction</span></span>
<span><span class="co">#&gt; 1 1.87866        NA       NA        NA      TRUE                0</span></span>
<span><span class="co">#&gt;   variance_method jacobian_condition_number max_equation_residual</span></span>
<span><span class="co">#&gt; 1            none                  36.83019           5.17808e-13</span></span>
<span><span class="co">#&gt;   min_denominator fraction_small_denominators nobs nobs_resp is_survey</span></span>
<span><span class="co">#&gt; 1       0.4613402                           0  500       150     FALSE</span></span></code></pre></div>
<p>Outputs and diagnostics at a glance (probability-scale weights sum to
1; population-scale weights sum to the analysis total
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mtext mathvariant="normal">pop</mtext></msub><annotation encoding="application/x-tex">N_\text{pop}</annotation></semantics></math>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.008384402 0.008937803 0.004381958 0.014450653 0.006959120 0.007160884</span></span>
<span><span class="co">#&gt;  [7] 0.005995129 0.006358571 0.007390444 0.007842733</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">fit</span>, scale <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 4.192201 4.468901 2.190979 7.225327 3.479560 3.580442 2.997564 3.179285</span></span>
<span><span class="co">#&gt;  [9] 3.695222 3.921366</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.2385382 0.2237686 0.4564170 0.1384020 0.2873926 0.2792951 0.3336042</span></span>
<span><span class="co">#&gt;  [8] 0.3145361 0.2706197 0.2550132</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">diagnostics</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 35</span></span>
<span><span class="co">#&gt;  $ convergence_code                  : int 1</span></span>
<span><span class="co">#&gt;  $ message                           : chr "Function criterion near zero"</span></span>
<span><span class="co">#&gt;  $ vcov_message                      : chr "Variance skipped (variance_method='none')"</span></span>
<span><span class="co">#&gt;  $ trimmed_fraction                  : num 0</span></span>
<span><span class="co">#&gt;  $ solver_method                     : chr "Newton"</span></span>
<span><span class="co">#&gt;  $ nleqslv_global                    : chr "qline"</span></span>
<span><span class="co">#&gt;  $ nleqslv_xscalm                    : chr "auto"</span></span>
<span><span class="co">#&gt;  $ solver_iterations                 : int 7</span></span>
<span><span class="co">#&gt;  $ solver_time                       : num 0.005</span></span>
<span><span class="co">#&gt;  $ variance_time                     : num 0.001</span></span>
<span><span class="co">#&gt;  $ reparam_W                         : chr "logit"</span></span>
<span><span class="co">#&gt;  $ max_equation_residual             : num 5.18e-13</span></span>
<span><span class="co">#&gt;  $ jacobian_condition_number         : num 36.8</span></span>
<span><span class="co">#&gt;  $ auxiliary_inconsistency_max_z     : num 0.114</span></span>
<span><span class="co">#&gt;  $ auxiliary_inconsistency_cols      : chr "X"</span></span>
<span><span class="co">#&gt;  $ min_denominator                   : num 0.461</span></span>
<span><span class="co">#&gt;  $ fraction_small_denominators       : num 0</span></span>
<span><span class="co">#&gt;  $ denom_q01                         : num 0.496</span></span>
<span><span class="co">#&gt;  $ denom_q05                         : num 0.664</span></span>
<span><span class="co">#&gt;  $ denom_median                      : num 1.05</span></span>
<span><span class="co">#&gt;  $ denom_count_lt_1e4                : int 0</span></span>
<span><span class="co">#&gt;  $ denom_floor                       : num 1e-08</span></span>
<span><span class="co">#&gt;  $ denom_floor_hits                  : num 0</span></span>
<span><span class="co">#&gt;  $ weight_max_share                  : num 0.0145</span></span>
<span><span class="co">#&gt;  $ weight_top5_share                 : num 0.0665</span></span>
<span><span class="co">#&gt;  $ weight_ess                        : num 137</span></span>
<span><span class="co">#&gt;  $ constraint_sum_W                  : num -3.33e-13</span></span>
<span><span class="co">#&gt;  $ constraint_sum_aux                : Named num -5.18e-13</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr "X"</span></span>
<span><span class="co">#&gt;  $ constraint_sum_link               : num NA</span></span>
<span><span class="co">#&gt;  $ sum_respondent_weights            : num 150</span></span>
<span><span class="co">#&gt;  $ sum_unnormalized_weights_untrimmed: num 150</span></span>
<span><span class="co">#&gt;  $ normalization_ratio               : num 1</span></span>
<span><span class="co">#&gt;  $ max_constraint_residual           : num 5.18e-13</span></span>
<span><span class="co">#&gt;  $ auxiliary_means                   : Named num 0</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr "X"</span></span>
<span><span class="co">#&gt;  $ auxiliary_matrix                  : num [1:150, 1] -0.56 -0.23 1.559 -1.265 -0.687 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:150] "1" "2" "3" "8" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "X"</span></span></code></pre></div>
<p>Bootstrap variance (keep reps small for speed). This example requires
the optional future.apply package; the chunk is skipped if it is not
installed:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/el_engine.html">el_engine</a></span><span class="op">(</span></span>
<span>  auxiliary_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  variance_method <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>  bootstrap_reps <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  standardize <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmar.html">nmar</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y_miss</span> <span class="op">~</span> <span class="va">X</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">engine</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/se.html">se</a></span><span class="op">(</span><span class="va">fit_boot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2817672</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_boot</span><span class="op">)</span></span>
<span><span class="co">#&gt;           2.5 %   97.5 %</span></span>
<span><span class="co">#&gt; Y_miss 1.326407 2.430914</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="respondents-only-data-n_total">Respondents-only data (n_total)<a class="anchor" aria-label="anchor" href="#respondents-only-data-n_total"></a>
</h2>
<p>If you pass respondents-only data (the outcome contains no NA),
provide the total sample size via <code>n_total</code> in the engine so
the estimator can recover the population response rate:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>; <span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>; <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Z</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">p</span></span>
<span><span class="va">df_resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y_miss <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span><span class="op">)</span>, <span class="va">R</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">eng_resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/el_engine.html">el_engine</a></span><span class="op">(</span>auxiliary_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, variance_method <span class="op">=</span> <span class="st">"none"</span>, n_total <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">fit_resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmar.html">nmar</a></span><span class="op">(</span><span class="va">Y_miss</span> <span class="op">~</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">df_resp</span>, engine <span class="op">=</span> <span class="va">eng_resp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_resp</span><span class="op">)</span></span>
<span><span class="co">#&gt; NMAR Model Summary</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; Y_miss mean: 1.509469</span></span>
<span><span class="co">#&gt; Converged: TRUE </span></span>
<span><span class="co">#&gt; Variance method: none </span></span>
<span><span class="co">#&gt; Variance notes: Variance skipped (variance_method='none') </span></span>
<span><span class="co">#&gt; Total units: 300 </span></span>
<span><span class="co">#&gt; Respondents: 102 </span></span>
<span><span class="co">#&gt; Call: nmar(Y_miss ~ X, data = &lt;data.frame: N=300&gt;, engine = empirical_likelihood)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Missingness-model coefficients:</span></span>
<span><span class="co">#&gt;              Estimate</span></span>
<span><span class="co">#&gt; (Intercept) -0.886331</span></span>
<span><span class="co">#&gt; Y_miss       0.145580</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="response-only-predictors">Response-only predictors<a class="anchor" aria-label="anchor" href="#response-only-predictors"></a>
</h2>
<p>You can include predictors that enter only the response model (and
are not constrained as auxiliaries) by placing them to the right of
<code>|</code> in the formula.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">125</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">400</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">Z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.6</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="va">Z</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">p</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y_miss <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, Z <span class="op">=</span> <span class="va">Z</span><span class="op">)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">Y_miss</span><span class="op">[</span><span class="op">!</span><span class="va">R</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span></span>
<span><span class="va">engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/el_engine.html">el_engine</a></span><span class="op">(</span>auxiliary_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, variance_method <span class="op">=</span> <span class="st">"none"</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use X as auxiliary (known population mean 0), and Z as response-only predictor</span></span>
<span><span class="va">fit_resp_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmar.html">nmar</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y_miss</span> <span class="op">~</span> <span class="va">X</span> <span class="op">|</span> <span class="va">Z</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df2</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">engine</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_resp_only</span><span class="op">)</span></span>
<span><span class="co">#&gt; NMAR Model Summary</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; Y_miss mean: 1.136991</span></span>
<span><span class="co">#&gt; Converged: TRUE </span></span>
<span><span class="co">#&gt; Variance method: none </span></span>
<span><span class="co">#&gt; Variance notes: Variance skipped (variance_method='none') </span></span>
<span><span class="co">#&gt; Total units: 400 </span></span>
<span><span class="co">#&gt; Respondents: 139 </span></span>
<span><span class="co">#&gt; Call: nmar(Y_miss ~ X | Z, data = &lt;data.frame: N=400&gt;, engine = empirical_likelihood)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Missingness-model coefficients:</span></span>
<span><span class="co">#&gt;              Estimate</span></span>
<span><span class="co">#&gt; (Intercept) -1.019139</span></span>
<span><span class="co">#&gt; Y_miss       0.369372</span></span>
<span><span class="co">#&gt; Z           -0.232795</span></span></code></pre></div>
<p>Auxiliary means and formulas:</p>
<ul>
<li>Names of <code>auxiliary_means</code> must match the
<code>model.matrix</code> columns generated by the outcome RHS (for
numeric variables this typically equals the variable names; for factors
it corresponds to the indicator columns).</li>
<li>When <code>standardize = TRUE</code>, the engine automatically
transforms <code>auxiliary_means</code> to the standardized scale
internally and reports coefficients on the original scale.</li>
<li>Response-only predictors (to the right of <code>|</code>) do not
need auxiliary means.</li>
</ul>
</div>
<div class="section level2">
<h2 id="survey-design-example-optional">Survey design example (optional)<a class="anchor" aria-label="anchor" href="#survey-design-example-optional"></a>
</h2>
<p>The estimator supports complex surveys via
<code><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">survey::svydesign()</a></code>. This chunk runs only if the
<code>survey</code> package is available. If the survey weights were
normalized (for example, rescaled to sum to the sample size), pass an
appropriate population total via <code>el_engine(n_total = ...)</code>
so that population-scale EL weights are on the intended scale.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">apiclus1</span><span class="op">$</span><span class="va">api00_miss</span> <span class="op">&lt;-</span> <span class="va">apiclus1</span><span class="op">$</span><span class="va">api00</span></span>
<span><span class="va">ystd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">apiclus1</span><span class="op">$</span><span class="va">api00</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="va">ystd</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">apiclus1</span><span class="op">$</span><span class="va">ell</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">apiclus1</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">prob</span></span>
<span><span class="va">apiclus1</span><span class="op">$</span><span class="va">api00_miss</span><span class="op">[</span><span class="va">miss</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span></span>
<span></span>
<span><span class="va">dclus1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>id <span class="op">=</span> <span class="op">~</span><span class="va">dnum</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">pw</span>, data <span class="op">=</span> <span class="va">apiclus1</span>, fpc <span class="op">=</span> <span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span>
<span><span class="co"># Let the engine infer auxiliary means from the full design (design-weighted).</span></span>
<span><span class="co"># Alternatively, you can supply known population means via auxiliary_means.</span></span>
<span><span class="va">engine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/el_engine.html">el_engine</a></span><span class="op">(</span>auxiliary_means <span class="op">=</span> <span class="cn">NULL</span>, variance_method <span class="op">=</span> <span class="st">"none"</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_svy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmar.html">nmar</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">api00_miss</span> <span class="op">~</span> <span class="va">ell</span> <span class="op">|</span> <span class="va">ell</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dclus1</span>,</span>
<span>  engine <span class="op">=</span> <span class="va">engine</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_svy</span><span class="op">)</span></span>
<span><span class="co">#&gt; NMAR Model Summary</span></span>
<span><span class="co">#&gt; =================</span></span>
<span><span class="co">#&gt; api00_miss mean: 667.708681</span></span>
<span><span class="co">#&gt; Converged: TRUE </span></span>
<span><span class="co">#&gt; Variance method: none </span></span>
<span><span class="co">#&gt; Variance notes: Variance skipped (variance_method='none') </span></span>
<span><span class="co">#&gt; Total units: 6194 </span></span>
<span><span class="co">#&gt; Respondents: 65 </span></span>
<span><span class="co">#&gt; Call: nmar(api00_miss ~ ell | ell, data = &lt;survey.design: N=6194&gt;, engine = empirical_likelihood)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Missingness-model coefficients:</span></span>
<span><span class="co">#&gt;              Estimate</span></span>
<span><span class="co">#&gt; (Intercept) -1.246046</span></span>
<span><span class="co">#&gt; api00_miss   0.000168</span></span>
<span><span class="co">#&gt; ell          0.019037</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="practical-guidance">Practical guidance<a class="anchor" aria-label="anchor" href="#practical-guidance"></a>
</h2>
<ul>
<li>Variance method: Analytical delta variance for EL is currently
disabled; use bootstrap for standard errors.</li>
<li>Trimming: Use a finite <code>trim_cap</code> to improve robustness
when large weights occur; prefer bootstrap variance when trimming.</li>
<li>Solver control: set
<code>control = list(xtol = 1e-10, ftol = 1e-10, maxit = 200)</code> for
tighter tolerances if needed. Globalization details are managed
internally by <code>nleqslv</code>.</li>
<li>Standardization: <code>standardize = TRUE</code> typically improves
numerical stability and comparability across predictors and auxiliary
means.</li>
<li>Diagnostics: Inspect <code>fit$diagnostics</code> (Jacobian
condition number, max equation residuals, trimming fraction) to assess
numerical health and identification strength.</li>
<li>Response-only predictors: Variables to the right of <code>|</code>
do not need to appear on the RHS of the outcome formula; they enter only
the response model. Auxiliary means must be supplied only for variables
on the outcome RHS.</li>
<li>Inconsistent auxiliaries: If provided auxiliary means are grossly
inconsistent with the respondent support, the engine will issue a
warning via auxiliary inconsistency diagnostics and the solver may fail
or yield highly concentrated weights. Consider revisiting the
constraints, relaxing them, or using <code>trim_cap</code> and bootstrap
variance.</li>
</ul>
<p>Troubleshooting:</p>
<ul>
<li>Extreme weights: set a finite <code>trim_cap</code>; prefer
<code>variance_method = "bootstrap"</code> for SE.</li>
<li>Ill-conditioned Jacobian (large
<code>fit$diagnostics$jacobian_condition_number</code>): prefer
<code>variance_method = "bootstrap"</code>. You may also tighten solver
tolerances via
<code>control = list(xtol=..., ftol=..., maxit=...)</code>.</li>
<li>Convergence issues: check
<code>fit$diagnostics$max_equation_residual</code>, rescale predictors
(<code>standardize = TRUE</code>), or reduce the number of
constraints.</li>
</ul>
</div>
<div class="section level2">
<h2 id="solver-control-and-notes">Solver control and notes<a class="anchor" aria-label="anchor" href="#solver-control-and-notes"></a>
</h2>
<ul>
<li>Control example: increase iterations and tighten tolerances via
<code>control</code> (passed to <code>nleqslv</code>):</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">200</span>, xtol <span class="op">=</span> <span class="fl">1e-10</span>, ftol <span class="op">=</span> <span class="fl">1e-10</span><span class="op">)</span></span>
<span><span class="va">eng_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/el_engine.html">el_engine</a></span><span class="op">(</span>auxiliary_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, variance_method <span class="op">=</span> <span class="st">"none"</span>, control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/nmar.html">nmar</a></span><span class="op">(</span><span class="va">Y_miss</span> <span class="op">~</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">dat</span>, engine <span class="op">=</span> <span class="va">eng_ctrl</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references-and-further-reading">References and further reading<a class="anchor" aria-label="anchor" href="#references-and-further-reading"></a>
</h2>
<ul>
<li>Qin, J., Leung, D., and Shao, J. (2002). Estimation with survey data
under nonignorable nonresponse or informative sampling. Journal of the
American Statistical Association, 97(457), 193-200. <a href="doi:10.1198/016214502753479338" class="uri">doi:10.1198/016214502753479338</a>
</li>
<li>Chen, J. and Sitter, R. R. (1999). A pseudo empirical likelihood
approach to the effective use of auxiliary information in complex
surveys. Statistica Sinica, 9, 385-406.</li>
<li>Wu, C. (2005). Algorithms and R codes for the pseudo empirical
likelihood method in survey sampling. Survey Methodology, 31(2),
239-243.</li>
</ul>
</div>
<div class="section level2">
<h2 id="families-and-numerical-stability">Families and numerical stability<a class="anchor" aria-label="anchor" href="#families-and-numerical-stability"></a>
</h2>
<ul>
<li>Family: <code>el_engine(family = "logit")</code> (default) or
<code>family = "probit"</code>.</li>
<li>Probit stability: the response-model score is evaluated as the Mills
ratio
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>η</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>Φ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>η</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\phi(\eta)/\Phi(\eta)</annotation></semantics></math>
in the log domain for numerical stability; the logit score simplifies to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mrow><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>η</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">1-\mathrm{plogis}(\eta)</annotation></semantics></math>.
We also cap the linear predictor and clip probabilities used in
ratios.</li>
<li>Theory mapping: see the companion article “Empirical Likelihood
Theory for NMAR” for equations, Jacobian blocks, and variance
details.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] grid      stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] survey_4.4-8   survival_3.8-3 Matrix_1.7-4   future_1.68.0  NMAR_0.0.0.1  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] future.apply_1.20.1 jsonlite_2.0.0      compiler_4.5.2     </span></span>
<span><span class="co">#&gt;  [4] Rcpp_1.1.0          nleqslv_3.3.5       parallel_4.5.2     </span></span>
<span><span class="co">#&gt;  [7] jquerylib_0.1.4     globals_0.18.0      splines_4.5.2      </span></span>
<span><span class="co">#&gt; [10] systemfonts_1.3.1   textshaping_1.0.4   yaml_2.3.12        </span></span>
<span><span class="co">#&gt; [13] fastmap_1.2.0       lattice_0.22-7      R6_2.6.1           </span></span>
<span><span class="co">#&gt; [16] generics_0.1.4      Formula_1.2-5       knitr_1.50         </span></span>
<span><span class="co">#&gt; [19] htmlwidgets_1.6.4   desc_1.4.3          DBI_1.2.3          </span></span>
<span><span class="co">#&gt; [22] bslib_0.9.0         rlang_1.1.6         cachem_1.1.0       </span></span>
<span><span class="co">#&gt; [25] xfun_0.54           fs_1.6.6            sass_0.4.10        </span></span>
<span><span class="co">#&gt; [28] cli_3.6.5           progressr_0.18.0    pkgdown_2.2.0      </span></span>
<span><span class="co">#&gt; [31] digest_0.6.39       lifecycle_1.0.4     evaluate_1.0.5     </span></span>
<span><span class="co">#&gt; [34] listenv_0.10.0      codetools_0.2-20    ragg_1.5.0         </span></span>
<span><span class="co">#&gt; [37] mitools_2.4         parallelly_1.46.0   rmarkdown_2.30     </span></span>
<span><span class="co">#&gt; [40] tools_4.5.2         htmltools_0.5.9</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="notes-on-variance-choices">Notes on variance choices<a class="anchor" aria-label="anchor" href="#notes-on-variance-choices"></a>
</h2>
<ul>
<li>Analytical delta variance for EL is not implemented in this version.
Use <code>variance_method = "bootstrap"</code> for SEs.</li>
<li>For speed-critical bootstraps, you can set
<code>variance_method = "none"</code> for point fits and let the
bootstrap call use it internally for replicates (this is the default
behavior when you request bootstrap SEs through
<code>el_engine(...)</code>).</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maciej Beręsewicz, Igor Kołodziej, Mateusz Iwaniuk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
